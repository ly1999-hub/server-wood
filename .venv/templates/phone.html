<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Capture Image</title>
</head>
<body>
    <h1>Capture Image from Camera</h1>
    <video id="video" width="1200" height="640" autoplay></video><br>
    <button id="captureButton">Capture</button><br>
    <canvas id="canvas" width="640" height="480"></canvas><br>
    <input type="file" id="fileInputs">
    <button id="uploadButton">Upload</button>
    <div id="result" style="margin-top: 10px;"></div>
    <div id="resultImage"></div>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const captureButton = document.getElementById('captureButton');
        const uploadButton = document.getElementById('uploadButton');

        captureButton.addEventListener('click', () => {
        // Lấy canvas context
            const context = canvas.getContext('2d');

            // Sao chép hình ảnh từ video element vào canvas
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Chuyển hình ảnh từ canvas thành Blob object
            canvas.toBlob((blob) => {
                // Tạo một FormData object
                const formData = new FormData();
                
                // Thêm ảnh từ Blob object vào FormData object
                formData.append('image', blob, 'image.jpg');

                // Gửi FormData object
                $.ajax({
                url: '/check-wood',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response=="Not wood"){
                        let div = document.createElement('div');
                        div.textContent = "hệ thống xác định không phải gỗ ! trong quá trình kiểm tra chúng tôi  có thể có sai sót  mời bạn thử lại";
                        div.classList.add('ClassName');
                        let container = document.getElementById('result');
                        container.appendChild(div)
                    }
                    else{
                        // document.getElementById('result').innerText = response;
                        let divList = document.createElement('div');
                        for (let i = 0; i < response[0].length; i++) {
                            let div = document.createElement('div');
                            div.textContent = response[1][i] + ' : ' + response[0][i];
                            div.classList.add('ClassName');
                            divList.appendChild(div);
                        }
                        let container = document.getElementById('result');
                        container.appendChild(divList);
                        // for(let i=0;i<6;i++){
                        //     var img = $("<img />", {
                        //         "src": "../static/images/tram-uc.jpg",
                        //         "alt": "Image " + i
                        //     });
                        //     // Append the image to the div
                        //     $('#resultImage').append(img);
                        // }
                    }
                },
                error: function(jqXHR, textStatus, errorMessage) {
                console.error('Failed to upload file:', errorMessage);
                }
            });
            }, 'image/jpeg', 0.5);
        })
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(error => {
                console.error('Error accessing camera:', error);
            });
    </script>
</body>
</html>
