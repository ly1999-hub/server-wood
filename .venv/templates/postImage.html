{% extends "base.html" %}
{% block content %}
<input type="file" id="fileInput">
<img src="#" id="previewImage" style="display: none; max-width: 300px; margin-top: 10px;">
<button class="btn btn-outline-success" onclick="uploadImage()" >Upload Image</button>
<div id="result" style="margin-top: 10px;"></div>
<div id="resultImage"></div>

<script>
    function uploadImage() {
        var elements = document.getElementsByClassName('ClassName');

        // Convert the HTMLCollection to an array for safe iteration
        var elementsArray = Array.from(elements);

        // Iterate through the array and remove each element
        elementsArray.forEach(function(element) {
            element.remove();
        });
        const fileInput = document.getElementById('fileInput');
        const formData = new FormData();
        formData.append('image', fileInput.files[0]);
        $.ajax({
            url: '/check-wood',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response=="Not wood"){
                    let div = document.createElement('div');
                    div.textContent = "hệ thống xác định không phải gỗ ! trong quá trình kiểm tra chúng tôi  có thể có sai sót  mời bạn thử lại";
                    div.classList.add('ClassName');
                    let container = document.getElementById('result');
                    container.appendChild(div)
                }
                else{
                    // document.getElementById('result').innerText = response;
                    let divList = document.createElement('div');
                    for (let i = 0; i < response[0].length; i++) {
                        let div = document.createElement('div');
                        div.textContent = response[1][i] + ' : ' + response[0][i];
                        div.classList.add('ClassName');
                        divList.appendChild(div);
                    }
                    let container = document.getElementById('result');
                    container.appendChild(divList);
                    // for(let i=0;i<6;i++){
                    //     var img = $("<img />", {
                    //         "src": "../static/images/tram-uc.jpg",
                    //         "alt": "Image " + i
                    //     });
                    //     // Append the image to the div
                    //     $('#resultImage').append(img);
                    // }
                }
            },
            error: function(jqXHR, textStatus, errorMessage) {
              console.error('Failed to upload file:', errorMessage);
            }
        });
    }

    fileInput.onchange = function() {
        const file = this.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewImage = document.getElementById('previewImage');
            previewImage.src = e.target.result;
            previewImage.style.display = 'block';
        };
        reader.readAsDataURL(file);
    };
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock %}
